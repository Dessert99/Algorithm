[https://school.programmers.co.kr/learn/courses/30/lessons/131118?language=mysql](https://school.programmers.co.kr/learn/courses/30/lessons/131118?language=mysql)
```sql
SELECT I.REST_ID, I.REST_NAME, I.FOOD_TYPE, I.FAVORITES, I.ADDRESS, ROUND(AVG(R.REVIEW_SCORE), 2) AS SCORE

FROM REST_INFO AS I
    JOIN REST_REVIEW AS R
        ON I.REST_ID = R.REST_ID

WHERE I.ADDRESS LIKE "서울%"

GROUP BY I.REST_ID, I.REST_NAME, I.FOOD_TYPE, I.FAVORITES, I.ADDRESS

ORDER BY AVG(R.REVIEW_SCORE) DESC, I.FAVORITES DESC
```
### 🔗 풀이
1. 조회 (SELECT)
    - 식당 ID (식당 테이블)
    - 식당 이름 (식당 테이블)
    - 음식 종류 (식당 테이블)
    - 즐겨찾기수 (식당 테이블)
    - 주소 (식당 테이블)
    - 리뷰 평균 점수 (리뷰 테이블에서 계산)
        - 리뷰 평균점수는 소수점 세 번째 자리에서 반올림
2. 조건 (WHERE)
    - 서울에 위치한 식당
3. 그룹 (GROUP BY)
    - 식당별로 리뷰 점수 평균
4. 정렬 (ORDER BT)
    - 평균점수를 기준으로 내림차순 정렬
    - 평균점수가 같다면 즐겨찾기수를 기준으로 내림차순 정렬
### 🔗 배운점

1. `GROUP BY` 기본 개념
   ```sql
    -- [O] 올바른 문법
    SELECT 
        FOOD_TYPE,          -- (1) 맨몸 컬럼 (기준)
        REST_NAME,          -- (2) 맨몸 컬럼 (기준)
        AVG(REVIEW_SCORE)   -- (3) 집계 함수 (계산)
    FROM REST_INFO
    GROUP BY 
        FOOD_TYPE,          -- (1)번 복사
        REST_NAME;          -- (2)번 복사
    ```
   - `SELECT` 절에는 `GROUP BY`에 쓰인 `column`만 사용가능하다.
   - 보통 집계 함수와 함께 사용한다.
2. `GROUP BY`위치
   ```sql
    SELECT ...
    FROM 테이블
    WHERE 조건        -- 1차 필터: "서울 식당만 남겨!" (데이터 쳐내기)
    GROUP BY 기준     -- 그룹핑: "남은 식당들을 종류별로 묶어!" (바구니 담기)
    HAVING 조건       -- 2차 필터: "리뷰 평균 3점 미만 그룹은 버려!" (그룹 쳐내기)
    ORDER BY 정렬;    -- 정렬: "점수 높은 순서대로 보여줘"
   ``` 
   - 필터링(`WHERE`)과 정렬(`ORDER BY`) 사이이다.
   - `FROM` (테이블 가져오기) → `WHERE` (쓸모없는 행 버리기) → `GROUP BY` (남은 거 묶기) → `HAVING` (묶은 그룹 필터링) → `SELECT` (보여주기) → `ORDER BY` (줄 세우기)
3. 만약 `GROUP BY`만 쓰고, 집계 함수를 안 쓰면 어떻게 될까?
   - `DISTINCT` (중복 제거)와 똑같이 동작한다.
   - 단순히 레코드를 뭉친 것과 같다.
4. 다양한 `GROUP BY` 예시
   - CASE 1. 정석적인 사용
     > "음식 종류별로 평균 리뷰 점수가 궁금해!" (카테고리별 통계)
   		```sql
			SELECT Food, AVG(Score) 
			FROM Table 
			GROUP BY Food;
     	```
     	[Before: 원본 데이터]
		| Food | Score |
		| :--- | :--- |
		| 치킨 | 100 |
		| 치킨 | 0 |
		| 피자 | 50 |
		
		[After: 결과 데이터]
		| Food | AVG(Score) |
		| :--- | :--- |
		| 치킨 | 50 (100과 0의 평균) |
		| 피자 | 50 (혼자니까 그대로) |
		- 💡 언제 써야 할까?: 특정 기준(성별, 지역, 부서 등)으로 데이터를 묶어서 통계(평균, 합계, 개수)를 낼 때
	- CASE 2. 에러가 나는 상황 (절대 금지)
	  > "음식 종류별로 묶었는데, 뜬금없이 식당 위치(Loc)도 보여달라고 할 때." (그룹핑 안 된 컬럼 조회)
   		```sql
			SELECT Food, Loc, AVG(Score)  -- Loc가 문제!
			FROM Table 
			GROUP BY Food;                -- Loc는 그룹 안 함
     	```
     	[Before: 원본 데이터]
		| Food | Loc | Score |
		| :--- | :--- | :--- |
		| 치킨 | 서울 | 100 |
		| 치킨 | 부산 | 0 |
		
		[After: 결과 데이터 (상상도)]
		| Food | Loc | AVG(Score) |
		| :--- | :--- | :--- |
		| 치킨 | ??? | 50 |
		- 💡 왜 안 될까?
			- 치킨은 한 줄로 합쳐졌는데, Loc 자리에 '서울'을 쓸지 '부산'을 쓸지 DB가 결정할 수 없어서 에러 발생.
			- 해결책: `GROUP BY` Food, Loc 처럼 Loc도 그룹핑 기준에 넣어줘야 함.
   - CASE 3. 의미 없는 계산 (하나마나)
     > "점수별로 묶어서 그 점수의 평균을 구해줘." (자기 자신을 기준으로 평균 내기)
     	```sql
			SELECT Score, AVG(Score) 
			FROM Table 
			GROUP BY Score;
      	```
      	[Before: 원본 데이터]
		| 학생 | Score |
		| :--- | :--- |
		| 철수 | 100 |
		| 영희 | 100 |
		| 민수 | 50 |
		
		[After: 결과 데이터]
		| Score | AVG(Score) |
		| :--- | :--- |
		| 100 | 100 (100점들의 평균은 당연히 100) |
		| 50 | 50 |
		- 💡 언제 써야 할까?
			- 사실상 `AVG`를 쓰는 건 의미가 없음. (수학적으로 동어반복)
			- 단, `AVG` 대신 `COUNT`를 쓴다면 "100점 맞은 사람이 몇 명이지?"를 구하는 아주 훌륭한 쿼리가 됨. (데이터 분포 확인용)
				```sql
					SELECT 
					    Score,          -- 기준: 점수별로
					    COUNT(Score)    -- 계산: 몇 개인지 세어라 (COUNT(*) 도 가능)
					FROM Table 
					GROUP BY Score;
    			```
    			[After: 결과 데이터]
				| Score | COUNT(Score) |
				| :--- | :--- |
				| 100 | 2 (철수, 영희) |
				| 50 | 1 (민수) |
